                         
						 Tc2.0编写俄罗斯方块游戏(9)

作者：陈畅
联系地址：上海财经大学图书馆
电子邮件：shchenchang@gmail.com
个人主页：http://shchenchang.spaces.live.com
QQ:7019717（欢迎编程爱好者加我为好友）


关于俄罗斯方块程序的一些问题：
******************************************************
Tc2.0中怎么样设置图形显示？
Tc2.0中常用图形函数的用法？
怎样获取I盘输入？
怎样控制方块的移动？
怎样控制时间间隔(用于游戏中控制形状的下落)？
游戏中的各种形状及整个游戏空间怎么用数据表示？
游戏中怎么判断左右及向下移动的可能性？
游戏中怎么判断某一形状旋转的可能性？
按向下方向键时加速某一形状下落速度的处理？
怎么判断某一形状已经到底？
怎么判断某一已经被填满？
怎么消去已经被填满的一行？
怎么消去某一形状落到底后能够消去的所有的行？(如长条最多可以消去四行)
怎样修改游戏板的状态？
怎样统计分数？
怎样处理升级后的加速问题？
怎样判断游戏结束？
关于计分板设计的问题。
关于“下一个”形状取法的问题。
剩下的问题。

******************************************************
新的问题：
我想有一个最高记录的显示，应该怎么做呀？
我想实现一个进度存储功能，应该怎么做呀？




剩下的问题。

程序里还有一些函数没有提到，其实看看函数名字就很好理解。

Welcome()
在程序开始显示一些有关程序的信息。

NewGame()
新的一局游戏开始时，初始化各类状态标志及分数等清0，同时重新绘制游戏板。

GameOver()
游戏结束时，显示提示信息。同时询问是否进行新游戏或是退出游戏。

下面是一些宏定义和全局变量作用的详细解释。

#define SIZE 16  /* 游戏块的大小 */
#define BGCOLOR DARKGRAY  /* 背景色 */
#define FORECOLOR WHITE   /* 前景色，用来标志游戏已被填充的部分 */
#define SCOREINTERVAL 30  /* 升级间隔的分数 */


/* global variables */
int board[12][22];   /* 记录游戏板当前状态的数组 */
int CurShape; /* 当前形状的索引号 */
int sx,sy;    /* 当前形状的(x,y)坐标 */
int next=-1;  /* “下一个”形状的索引号。初值为-1，表示还没有“下一个”形状 */
long score=0; /* 分数 */
long speed=0; /* 速度 */
lnNextLevelScore=SCOREINTERVAL; /* 升级需要超过的分数 */

/* 指向原有时钟中断处理的指针 */
void interrupt (*oldtimer)(void);/* function pointer variable */

/* 形状数据 */
struct shape shapes[19]=
	{
	……
	};


/* 计时变量 */
unsigned int TimerCounter=0;



整个程序的处理都在主函数main()中了，而且我觉得主函数的结构很清楚。所有的要点在前
面都已经提到了。仔细看看主函数，再想想我们玩这个游戏的过程，就不难理解整个程序的
结构了。





新的问题。

我想有一个最高记录的显示，并且游戏结束之后也能够保存这个最高记录，应该怎么做呀？

这时，可以增加一个全局变量nHiScore。要求游戏结束之后也能够保存这个最高记录，则必
须有个文件来保存这个最高记录。

假定保存最高记录的文件为"hiscore.sco"（你也可以取别的名字）。
在开始一局新游戏的时候（或这进入程序的时候），比如在NewGame()函数中，可以添加一
个读文件的操作，从"hiscore.sco"读入最高记录，放在nHiScore。
在游戏进行当中，如果当前分数score大于最高记录nHiScore，那么修改nHiScore为score。
在一局游戏结束时（或退出程序的时候），将nHiScore写回"hiscore.sco"，覆盖掉原来的
那个文件即可。

那如果保存最高记录的文件丢失了怎么办？这个也好办。文件丢失了，在读取记录时会打不
开文件。这样打开文件的fopen()将会返回NULL。这时将nHiScore设为0（或者你想要的nHiS
core的一个初值）。而在保存最高记录时，将会重新生成"hiscore.sco"这个文件。

当然，因为添加了最高记录，你还要添加一个显示最高记录的记分板。在最高记录发生变化
的时候，要刷新这个记分板。


现在已经可以实现最高记录的读取和保存了，可是我还想要一个存盘功能。玩到一半，存个
进度。退出程序后能够读取进度接着玩。或者觉得后面一段玩的形势不好，可以读取前面形
势较好的进度。这个该怎么做呀？

这个问题处理方法和最高记录的存储与读取类似。
首先，要定一个能够存储游戏那一时刻所有游戏状态的文件结构。应当包括当前形状的序号
和坐标、“下一个”形状的序号、当前速度、分数、最高纪录和游戏板的状态。
如果玩到一半，要实现进度存储。就按照上面的文件结构将游戏状态保存下来。
如果要读取进度，就按照上面的文件结构读取数据，恢复存取进度时的游戏的状态。注意，
光是将各种变量恢复原值了之后事情还没完。还要刷新整个游戏界面的显示。如游戏板的显
示、当前形状的显示、“下一个”形状的显示，速度、分数和最高纪录的显示。这样就实现
了游戏进度的读取。
存储进度和读取进度要放在游戏循环的同一个阶段，这样才能的实现原有游戏状态的复原。


对于这两个新问题，我讲得比较笼统了一些。但是，我已经把主要思路讲出来了，具体怎么
做就看你的了。编程本来就是很灵活的东西，讲得太明白有时候会限制人的创造力。当初编
写这个程序的时候，我没有参考过任何有关编写俄罗斯方块游戏的资料，以上各种各样的解
决方法都是我根据玩这个游戏的经验想出来的。这是我后来学习编程是一个很好的起点，极
大的增强了我学习编程的兴趣和自信心，尽管现在看来这是个很不起眼的程序。留下上面两
个未完成的问题，仁者见仁，智者见智。给各们一个发挥的空间吧。

最后，希望各们热爱编程的朋友一起进步!

